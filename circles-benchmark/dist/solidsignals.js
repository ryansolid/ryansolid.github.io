!function(){"use strict";function n(n,e){const l=new t(n);let o;if(e){let t=-1;o=o=>{if(!e(n,o)){const e=a.time;if(e===t)throw new Error(`Conflicting value update: ${o} is not the same as ${n}`);t=e,n=o,l.next(o)}}}else o=l.next.bind(l);return[l.current.bind(l),o]}function e(n,e){!function(n,e,t,l){var o=v(),s=h,u=f,r=null===d;h=o,f=l?null:o,e=r?function(n,e){d=a,a.changes.reset(),a.updates.reset();try{return n(e)}finally{h=f=d=null}}(n,e):n(e);h=s,f=u;var i=w(o,n,e,t);r&&function(n,e){if(a.changes.count>0||a.updates.count>0){a.time++;try{C(a)}finally{d=null,h=n,f=e}}}(s,u);g.node=i?null:o,g.value=e}(n,e,!1,!1)}class t{constructor(n){this.value=n,this.pending=s,this.log=null}current(){return null!==f&&function(n){null===n.log&&(n.log={node1:null,node1slot:0,nodes:null,nodeslots:null});m(n.log)}(this),this.value}next(n){if(null!==d)if(this.pending!==s){if(n!==this.pending)throw new Error("conflicting changes: "+n+" !== "+this.pending)}else this.pending=n,a.changes.add(this);else null!==this.log?(this.pending=n,a.changes.add(this),y()):this.value=n;return n}}class l{constructor(){this.fn=null,this.age=-1,this.state=u,this.source1=null,this.source1slot=0,this.sources=null,this.sourceslots=null,this.log=null,this.owner=h,this.owned=null,this.cleanups=null}current(){if(null!==f){if(this.age===a.time){if(this.state===i)throw new Error("circular dependency");S(this)}!function(n){null===n.log&&(n.log={node1:null,node1slot:0,nodes:null,nodeslots:null});m(n.log)}(this)}return this.value}}class o{constructor(){this.items=[],this.count=0}reset(){this.count=0}add(n){this.items[this.count++]=n}run(n){for(var e=this.items,t=0;t<this.count;t++)n(e[t]),e[t]=null;this.count=0}}var s={},u=0,r=1,i=2,c=new l,a={time:0,changes:new o,updates:new o,disposes:new o},d=null,f=null,h=null,p=null,g={node:null,value:void 0};function v(){var n=p;return null===n?n=new l:p=null,n}function w(n,e,t,l){var o,s=l||null===h||h===c?null:h,u=null===n.source1&&(null===n.owned&&null===n.cleanups||null!==s);if(u){if(p=n,null!==s){if(null!==n.owned){if(null===s.owned)s.owned=n.owned;else for(o=0;o<n.owned.length;o++)s.owned.push(n.owned[o]);n.owned=null}if(null!==n.cleanups){if(null===s.cleanups)s.cleanups=n.cleanups;else for(o=0;o<n.cleanups.length;o++)s.cleanups.push(n.cleanups[o]);n.cleanups=null}}}else n.fn=e,n.value=t,n.age=a.time,null!==s&&(null===s.owned?s.owned=[n]:s.owned.push(n));return u}function m(n){var e,t=f,l=null===t.source1?-1:null===t.sources?0:t.sources.length;null===n.node1?(n.node1=t,n.node1slot=l,e=-1):null===n.nodes?(n.nodes=[t],n.nodeslots=[l],e=0):(e=n.nodes.length,n.nodes.push(t),n.nodeslots.push(l)),null===t.source1?(t.source1=n,t.source1slot=e):null===t.sources?(t.sources=[n],t.sourceslots=[e]):(t.sources.push(n),t.sourceslots.push(e))}function y(){var n=h;a.updates.reset(),a.time++;try{C(a)}finally{d=f=null,h=n}}function C(n){var e=d,t=0;for(d=n,n.disposes.reset();0!==n.changes.count||0!==n.updates.count||0!==n.disposes.count;)if(t>0&&n.time++,n.changes.run(b),n.updates.run(S),n.disposes.run(E),t++>1e5)throw new Error("Runaway clock detected");d=e}function b(n){n.value=n.pending,n.pending=s,n.log&&x(n.log)}function x(n){var e=n.node1,t=n.nodes;if(null!==e&&N(e),null!==t)for(var l=0,o=t.length;l<o;l++)N(t[l])}function N(n){var e=a.time;n.age<e&&(n.age=e,n.state=r,a.updates.add(n),null!==n.owned&&function n(e){for(var t=0;t<e.length;t++){var l=e[t];l.age=a.time,l.state=u,null!==l.owned&&n(l.owned)}}(n.owned),null!==n.log&&x(n.log))}function S(n){if(n.state===r){var e=h,t=f;h=f=n,n.state=i,T(n,!1),n.value=n.fn(n.value),n.state=u,h=e,f=t}}function T(n,e){var t,l,o=n.source1,s=n.sources,u=n.sourceslots,r=n.cleanups,i=n.owned;if(null!==r){for(t=0;t<r.length;t++)r[t](e);n.cleanups=null}if(null!==i){for(t=0;t<i.length;t++)E(i[t]);n.owned=null}if(null!==o&&(A(o,n.source1slot),n.source1=null),null!==s)for(t=0,l=s.length;t<l;t++)A(s.pop(),u.pop())}function A(n,e){var t,l,o=n.nodes,s=n.nodeslots;-1===e?n.node1=null:(t=o.pop(),l=s.pop(),e!==o.length&&(o[e]=t,s[e]=l,-1===l?t.source1slot=e:t.sourceslots[l]=e))}function E(n){n.fn=null,n.log=null,n.owner=null,T(n,!0)}const k="__rGroup",B="previousSibling";let $=0;function F(n,e,t,l){if(Array.isArray(e)){if(!e.length)return;let o=(e=function n(e,t){for(let l=0,o=t.length;l<o;l++){let o=t[l];o instanceof Node?11===o.nodeType?n(e,o.childNodes):e.push(o):null==o||!0===o||!1===o||(Array.isArray(o)?n(e,o):"string"==typeof o?e.push(document.createTextNode(o)):e.push(document.createTextNode(o.toString())))}return e}([],e))[0];1!==e.length&&(o[k]=e[e.length-1][k]=l);for(let l=0;l<e.length;l++)t?n.insertBefore(e[l],t):n.appendChild(e[l]);return o}let o,s=typeof e;return"string"===s||"number"===s?e=document.createTextNode(e):11===e.nodeType&&(o=e.firstChild)&&o!==e.lastChild&&(o[k]=e.lastChild[k]=l),t?n.insertBefore(e,t):n.appendChild(e),o||e}function L(n,e,t,l){return void 0===t?n.textContent="":(Array.isArray(e)?l=e[0]:null!=e&&""!=e&&void 0===l&&(l=function(n,e,t){const l=n[k];if(l)for(n=n[e];n&&n[k]!==l;)n=n[e];return t?n:n[e]}(t.previousSibling,B,!0)),l&&function(n,e,t){let l;for(;e!==t;)l=e.nextSibling,n.removeChild(e),e=l}(n,l,t),"")}function M(n,t,l,o){if(t===l)return l;n=o&&o.parentNode||n;const s=typeof t;if("string"===s||"number"===s)if("number"===s&&(t=t.toString()),void 0!==o){const e=o&&o.previousSibling||n.lastChild;if(""===t)L(n,l,o);else if(""!==l&&"string"==typeof l)e.data=t;else{const s=document.createTextNode(t);""!==l&&null!=l?n.replaceChild(s,e):n.insertBefore(s,o)}l=t}else l=""!==l&&"string"==typeof l?n.firstChild.data=t:n.textContent=t;else if(null==t||"boolean"===s)l=L(n,l,o);else if("function"===s)e(function(){l=M(n,t(),l,o)});else{if(!(t instanceof Node||Array.isArray(t)))throw new Error("content must be Node, stringable, or array of same");L(n,l,o),F(n,t,o,++$),l=t}return l}function _(n,t,l,o){if("function"!=typeof t)return M(n,t,l,o);e((e=l)=>M(n,t(),e,o))}const j=document.createElement("template");function D(n){const e=++n.count;n.setTop(10*Math.sin(e/10)),n.setLeft(10*Math.cos(e/10)),n.setColor(e%255),n.setContent(e%100)}j.innerHTML="<div class='box-view'><div class='box'></div></div>";const G=()=>{const t=function(e){const t=[];for(let l=0;l<e;l++){const[e,l]=n(0),[o,s]=n(0),[u,r]=n(null),[i,c]=n(0);t.push({top:e,left:o,color:u,content:i,setTop:l,setLeft:s,setColor:r,setContent:c,count:0})}return t}(Benchmark.number);return Benchmark.Framework.SolidSignals.loop=()=>Promise.resolve().then(()=>(function(n){var e=void 0;if(null!==d)e=n();else{(d=a).changes.reset();try{e=n(),y()}finally{d=null}}return e})(()=>t.forEach(D))),function(){const n=document.createDocumentFragment();return _(n,t.map((n,t)=>(function(){const l=j.content.firstChild.cloneNode(!0),o=l.firstChild;return o.id=t,e(()=>Object.assign(o.style,{top:`${n.top()}px`,left:`${n.left()}px`,background:`rgb(0,0,${n.color()})`})),_(o,n.content),l})())),n}()};let H;Benchmark.Framework.SolidSignals={start(){!function(n,e){var t,l=h,o=0===n.length?null:function(){null===s||(null!==d?a.disposes.add(s):E(s))},s=null===o?c:v();s.owner=e||h,h=s;try{t=null===o?n():n(o)}finally{h=l}null!==o&&w(s,null,void 0,!0)&&(s=null)}(n=>{H=n,document.getElementById("grid").appendChild(G())})},cleanup(){H&&H()}}}();
