!function(){"use strict";var n=function(n,t){var e=new r(n,t);return function(){return e.current()}};Object.defineProperty(n,"default",{value:n}),n.root=function(n){var t=p,e=0===n.length?g:new r(null,null),o=void 0,l=0===n.length?null:function(){null!==d?f.disposes.add(e):S(e)};return p=e,null===d?o=function(n,t,e){try{return null===t?n():n(t)}finally{p=e}}(n,l,t):(o=null===l?n():n(l),p=t),o},n.on=function(t,e,o,r){var l;return Array.isArray(t)&&(l=t,t=function(){for(var n=0;n<l.length;n++)l[n]()}),r=!!r,n(u,o);function u(n){var o=h;return t(),r?r=!1:(h=null,n=e(n),h=o),n}},n.effect=function(n,t){new r(n,t)},n.data=function(n){var t=new o(n);return function(n){return 0===arguments.length?t.current():t.next(n)}},n.value=function(t,e){var o=n.data(t),r=-1;return function(n){if(0===arguments.length)return o();if(!(e?e(t,n):t===n)){var l=f.time;if(r===l)throw new Error("conflicting values: "+n+" is not the same as "+t);r=l,t=n,o(n)}return n}},n.freeze=function(n){var t=void 0;if(null!==d)t=n();else{(d=f).changes.reset();try{t=n(),m()}finally{d=null}}return t},n.sample=function(n){var t,e=h;return null!==e?(h=null,t=n(),h=e):t=n(),t},n.cleanup=function(n){null!==p?null===p.cleanups?p.cleanups=[n]:p.cleanups.push(n):console.warn("cleanups created without a root or parent will never be run")},n.makeDataNode=function(n){return new o(n)},n.makeComputationNode=function(n,t){return new r(n,t)},n.isFrozen=function(){return null!==d},n.isListening=function(){return null!==h};var t=function(){return function(){this.time=0,this.changes=new u,this.updates=new u,this.disposes=new u}}(),e={time:function(){return f.time}},o=function(){function n(n){this.value=n,this.pending=i,this.log=null}return n.prototype.current=function(){return null!==h&&function(n,t){null===n.log&&(n.log=new l);v(n.log,t)}(this,h),this.value},n.prototype.next=function(n){if(null!==d)if(this.pending!==i){if(n!==this.pending)throw new Error("conflicting changes: "+n+" !== "+this.pending)}else this.pending=n,f.changes.add(this);else null!==this.log?(this.pending=n,f.changes.add(this),m()):this.value=n;return n},n.prototype.clock=function(){return e},n}(),r=function(){function n(n,t){if(this.state=s,this.source1=null,this.source1slot=0,this.sources=null,this.sourceslots=null,this.log=null,this.owned=null,this.cleanups=null,this.fn=n,this.value=t,this.age=f.time,null!==n){var e=p,o=h;null===e&&console.warn("computations created without a root or parent will never be disposed"),p=h=this,null===d?function(n){d=f,f.changes.reset(),f.updates.reset();try{n.value=n.fn(n.value),(f.changes.count>0||f.updates.count>0)&&(f.time++,w(f))}finally{d=p=h=null}}(this):this.value=this.fn(this.value),e&&e!==g&&(null===e.owned?e.owned=[this]:e.owned.push(this)),p=e,h=o}}return n.prototype.current=function(){if(null!==h){if(this.age===f.time){if(this.state===a)throw new Error("circular dependency");x(this)}!function(n,t){null===n.log&&(n.log=new l);v(n.log,t)}(this,h)}return this.value},n.prototype.clock=function(){return e},n}(),l=function(){return function(){this.node1=null,this.node1slot=0,this.nodes=null,this.nodeslots=null}}(),u=function(){function n(){this.items=[],this.count=0}return n.prototype.reset=function(){this.count=0},n.prototype.add=function(n){this.items[this.count++]=n},n.prototype.run=function(n){for(var t=this.items,e=0;e<this.count;e++)n(t[e]),t[e]=null;this.count=0},n}(),i={},s=0,c=1,a=2,f=new t,d=null,h=null,p=null,g=new r(null,null);function v(n,t){var e,o=null===t.source1?-1:null===t.sources?0:t.sources.length;null===n.node1?(n.node1=t,n.node1slot=o,e=-1):null===n.nodes?(n.nodes=[t],n.nodeslots=[o],e=0):(e=n.nodes.length,n.nodes.push(t),n.nodeslots.push(o)),null===t.source1?(t.source1=n,t.source1slot=e):null===t.sources?(t.sources=[n],t.sourceslots=[e]):(t.sources.push(n),t.sourceslots.push(e))}function m(){var n=p;f.updates.reset(),f.time++;try{w(f)}finally{d=h=null,p=n}}function w(n){var t=d,e=0;for(d=n,n.disposes.reset();0!==n.changes.count||0!==n.updates.count||0!==n.disposes.count;)if(e>0&&n.time++,n.changes.run(y),n.updates.run(x),n.disposes.run(S),e++>1e5)throw new Error("Runaway clock detected");d=t}function y(n){n.value=n.pending,n.pending=i,n.log&&b(n.log)}function b(n){var t=n.node1,e=n.nodes;if(null!==t&&C(t),null!==e)for(var o=0,r=e.length;o<r;o++)C(e[o])}function C(n){var t=f.time;n.age<t&&(n.age=t,n.state=c,f.updates.add(n),null!==n.owned&&function n(t){for(var e=0;e<t.length;e++){var o=t[e];o.age=f.time,o.state=s,null!==o.owned&&n(o.owned)}}(n.owned),null!==n.log&&b(n.log))}function x(n){if(n.state===c){var t=p,e=h;p=h=n,n.state=a,k(n,!1),n.value=n.fn(n.value),n.state=s,p=t,h=e}}function k(n,t){var e,o,r=n.source1,l=n.sources,u=n.sourceslots,i=n.cleanups,s=n.owned;if(null!==i){for(e=0;e<i.length;e++)i[e](t);n.cleanups=null}if(null!==s){for(e=0;e<s.length;e++)S(s[e]);n.owned=null}if(null!==r&&(N(r,n.source1slot),n.source1=null),null!==l)for(e=0,o=l.length;e<o;e++)N(l.pop(),u.pop())}function N(n,t){var e,o,r=n.nodes,l=n.nodeslots;-1===t?n.node1=null:(e=r.pop(),o=l.pop(),t!==r.length&&(r[t]=e,l[t]=o,-1===o?e.source1slot=t:e.sourceslots[o]=t))}function S(n){n.fn=null,n.log=null,k(n,!0)}const A=n,E="__rGroup",T="previousSibling";let B=0;function $(n,t,e,o){if(Array.isArray(t)){if(!t.length)return;let r=(t=function n(t,e){for(let o=0,r=e.length;o<r;o++){let r=e[o];r instanceof Node?11===r.nodeType?n(t,r.childNodes):t.push(r):null==r||!0===r||!1===r||(Array.isArray(r)?n(t,r):"string"==typeof r?t.push(document.createTextNode(r)):t.push(document.createTextNode(r.toString())))}return t}([],t))[0];1!==t.length&&(r[E]=t[t.length-1][E]=o);for(let o=0;o<t.length;o++)e?n.insertBefore(t[o],e):n.appendChild(t[o]);return r}let r,l=typeof t;return"string"===l||"number"===l?t=document.createTextNode(t):11===t.nodeType&&(r=t.firstChild)&&r!==t.lastChild&&(r[E]=t.lastChild[E]=o),e?n.insertBefore(t,e):n.appendChild(t),r||t}function F(n,t,e,o){return e?(Array.isArray(t)?o=t[0]:null!=t&&""!=t&&void 0===o&&(o=function(n,t,e){const o=n[E];if(o)for(n=n[t];n&&n[E]!==o;)n=n[t];return e?n:n[t]}(e.previousSibling,T,!0)),o&&function(n,t,e){let o;for(;t!==e;)o=t.nextSibling,n.removeChild(t),t=o}(n,o,e),""):n.textContent=""}function L(n,t,e,o){if(t===e)return e;n=o&&o.parentNode||n;const r=typeof t;if("string"===r||"number"===r)if("number"===r&&(t=t.toString()),o){if(""===t)F(n,e,o);else if(""!==e&&"string"==typeof e)o.previousSibling.data=t;else{const r=document.createTextNode(t);""!==e&&null!=e?n.replaceChild(r,o.previousSibling):n.insertBefore(r,o)}e=t}else e=""!==e&&"string"==typeof e?n.firstChild.data=t:n.textContent=t;else if(null==t||"boolean"===r)e=F(n,e,o);else if("function"===r)A(function(){e=L(n,t(),e,o)});else{if(!(t instanceof Node||Array.isArray(t)))throw new Error("content must be Node, stringable, or array of same");F(n,e,o),$(n,t,o,++B),e=t}return e}function z(n,t,e,o){if("function"!=typeof t)return L(n,t,e,o);A((r=e)=>L(n,t(),r,o))}function D(t,e){const o=n.makeDataNode(t);let r;if(e){let n=-1;r=(r=>{if(!e(t,r)){const e=o.clock().time();if(e===n)throw new Error(`Conflicting value update: ${r} is not the same as ${t}`);n=e,t=r,o.next(r)}})}else r=o.next.bind(o);return[o.current.bind(o),r]}const{root:M,cleanup:j,sample:O,freeze:P}=n,_=document.createElement("template");function G(n){const t=++n.count;n.setTop(10*Math.sin(t/10)),n.setLeft(10*Math.cos(t/10)),n.setColor(t%255),n.setContent(t%100)}_.innerHTML="<div class='box-view'><div class='box'></div></div>";const H=()=>{const n=function(n){const t=[];for(let e=0;e<n;e++){const[n,e]=D(0),[o,r]=D(0),[l,u]=D(null),[i,s]=D(0);t.push({top:n,left:o,color:l,content:i,setTop:e,setLeft:r,setColor:u,setContent:s,count:0})}return t}(Benchmark.number);return Benchmark.Framework.SolidSignals.loop=(()=>Promise.resolve().then(()=>P(()=>n.forEach(G)))),function(){const t=document.createDocumentFragment();return z(t,n.map((n,t)=>(function(){const e=_.content.firstChild.cloneNode(!0),o=e.firstChild;return o.id=t,A(()=>Object.assign(o.style,{top:`${n.top()}px`,left:`${n.left()}px`,background:`rgb(0,0,${n.color()})`})),z(o,n.content),e})())),t}()};let I;Benchmark.Framework.SolidSignals={start(){M(n=>{I=n,document.getElementById("grid").appendChild(H())})},cleanup(){I&&I()}}}();
